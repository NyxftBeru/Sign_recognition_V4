<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SignEase Chatbot</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Global styles (matching index.html) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body.chatbot-page {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            /* Removed padding-top as navbar is now sticky, not fixed */
            /* padding-top: 56px; */
        }

        /* NAVBAR STYLES (MATCHING index.html) */
        .navbar {
            background: white;
            padding: 1rem 2rem; /* Matches index.html padding */
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); /* Matches index.html shadow */
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100vw; /* Ensure it spans full width */
            max-width: 100vw; /* Ensure it spans full width */
            position: sticky; /* Changed to sticky */
            top: 0;
            z-index: 100;
            /* Removed min-height as it's not explicitly in index.html's navbar */
            /* Removed left:0 and width:100% as 'width:100vw' covers it for sticky */
        }

        .logo {
            font-size: 1.8rem; /* Matches index.html font-size */
            font-weight: 700;
            color: #2c3e50;
            text-decoration: none;
            /* Removed letter-spacing: 1px; if not in index.html */
        }

        .logo span {
            color: #3498db;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            /* Removed padding-right: 3.5rem; as it's not in index.html */
        }

        .nav-links a {
            color: #2c3e50;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
            /* Removed position: relative; and padding: 2px 0; if not in index.html */
        }

        .nav-links a.active {
            color: #3498db;
            font-weight: 600;
        }

        .nav-links a:hover {
            color: #3498db;
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
        }

        /* CHATBOT SPECIFIC STYLES (from your original chatbot.html, with indentation fixed) */
        .chatbot-container {
            max-width: 500px;
            margin: 48px auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(44,62,80,0.10);
            padding: 2rem;
        }

        .chatbox {
            min-height: 180px;
            max-height: 350px;
            overflow-y: auto;
            margin-bottom: 1.5rem;
            background: #fafdff;
            border-radius: 8px;
            padding: 1rem;
        }

        .chat-message {
            margin-bottom: 1rem;
            display: flex;
        }

        .chat-message.user {
            justify-content: flex-end;
        }

        .chat-message.bot {
            justify-content: flex-start;
        }

        .bubble {
            padding: 0.75rem 1.2rem;
            border-radius: 18px;
            background: #3498db;
            color: #fff;
            font-size: 1rem;
            max-width: 80%;
            word-break: break-word;
        }

        .chat-message.user .bubble {
            background: #43e97b;
            color: #fff;
        }

        .input-row {
            display: flex;
            gap: 0.5rem;
        }

        #userInput {
            flex: 1;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1.5px solid #3498db;
            font-size: 1rem;
        }

        .input-row button {
            background: #3498db;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .input-row button:hover {
            background: #2980b9;
        }

        .back-link {
            display: block;
            margin: 2rem auto 0 auto;
            text-align: center;
            color: #3498db;
            font-weight: 600;
            text-decoration: none;
            font-size: 1.1rem;
            transition: color 0.2s;
        }

        .back-link:hover {
            color: #2980b9;
            text-decoration: underline;
        }

        .typing {
            display: flex;
            gap: 4px;
            align-items: center;
            margin-bottom: 1rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #3498db;
            border-radius: 50%;
            animation: blink 1s infinite alternate;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes blink {
            to {
                opacity: 0.3;
            }
        }

        /* Styles for the Telegram links */
        .telegram-button-group {
            display: flex;
            flex-direction: row;
            gap: 1.5rem; /* Increased gap for text links */
            justify-content: center;
            margin: 1.5rem auto 0.5rem auto;
            width: 100%;
            flex-wrap: wrap;
        }

        .telegram-link { /* Renamed class to better reflect 'link' nature */
            display: inline-block; /* Allows vertical alignment and some spacing */
            font-size: 1rem; /* Adjust font size as desired */
            font-weight: 600;
            text-align: center;
            text-decoration: none; /* No underline by default */
            cursor: pointer; /* Standard pointer cursor for links */
            transition: color 0.2s ease, text-decoration 0.2s ease; /* Smooth transition for color and underline */

            /* Removed button-specific styles */
            /* No background, no border, no border-radius, no padding for a pure link look */
            /* flex properties (flex: 1, min-width, max-width) are also removed as they are not needed for inline-block links */
        }

        /* Specific color for the SGSL link */
        .telegram-link-sgsl {
            color: #0088cc; /* Telegram blue text */
        }

        .telegram-link-sgsl:hover {
            color: #006699; /* Darker blue text on hover */
            text-decoration: underline; /* Underline on hover */
        }

        /* Specific color for the ASL link */
        .telegram-link-asl {
            color: #3498db; /* A distinct blue for ASL text */
        }

        .telegram-link-asl:hover {
            color: #2980b9; /* Darker shade for ASL text hover */
            text-decoration: underline; /* Underline on hover */
        }
    </style>
</head>
<body class="chatbot-page">
    <nav class="navbar">
        <a href="index.html" class="logo">Sign<span>Ease</span></a>
        <div class="nav-links">
            <a href="index.html">Home</a>
            <a href="predict_live.html">Try Demo</a>
            <a href="about.html">About</a>
            <a href="chatbot.html" class="active">Chatbot</a>
            <a href="index.html#contact">Contact</a>
            <a href="/profile">Profile</a> </div>
    </nav>

    <div class="chatbot-container">
        <div class="chatbox" id="chatbox">
            <div><em>Welcome! Ask me anything about sign language, gestures, or how to use SignEase.</em></div>
        </div>
        <div class="input-row">
            <input type="text" id="userInput" placeholder="Type your message..." autocomplete="off" required />
            <button onclick="sendMessage()">Send</button>
        </div>

        <div class="telegram-button-group">
            <a href="https://t.me/SignEaseSGSL_bot" target="_blank" class="telegram-link telegram-link-sgsl">
                Chat on Telegram (SGSL)
            </a>
            <a href="https://t.me/SignEaseASL_bot" target="_blank" class="telegram-link telegram-link-asl">
                Chat on Telegram (ASL)
            </a>
        </div>
        <a href="index.html" class="back-link">&larr; Back to Home</a>
    </div>

    <script>
        const chatBox = document.getElementById('chatbox');

        function appendMessage(text, sender = 'bot') {
            const message = document.createElement('div');
            message.classList.add('chat-message', sender);

            const bubble = document.createElement('div');
            bubble.classList.add('bubble');
            bubble.innerHTML = text;

            message.appendChild(bubble);
            chatBox.appendChild(message);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function appendVideoOrEmbed(videoUrl) {
            const message = document.createElement('div');
            message.classList.add('chat-message', 'bot');
            message.style.marginBottom = '1rem';

            // Check if it's a Google Drive file link
            const gdMatch = videoUrl.match(/https:\/\/drive\.google\.com\/file\/d\/([a-zA-Z0-9_-]+)\/view/);

            if (gdMatch && gdMatch[1]) {
                const fileId = gdMatch[1];
                const iframe = document.createElement('iframe');
                iframe.src = `https://drive.google.com/file/d/${fileId}/preview`;
                iframe.width = '100%';
                iframe.height = 315;
                iframe.allow = 'autoplay; encrypted-media';
                iframe.style.border = 'none';
                iframe.style.borderRadius = '12px';
                message.appendChild(iframe);
            } else {
                // fallback to normal video tag for direct mp4 links
                const video = document.createElement('video');
                video.src = videoUrl;
                video.controls = true;
                video.style.maxWidth = '100%';
                video.style.borderRadius = '12px';
                message.appendChild(video);
            }

            chatBox.appendChild(message);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function appendTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.classList.add('typing');
            typingDiv.innerHTML = `
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            `;
            chatBox.appendChild(typingDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
            return typingDiv;
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;

            appendMessage(message, 'user');
            input.value = '';

            const typingBubble = appendTyping();

            try {
                const res = await fetch('https://n8nc240.southeastasia.cloudapp.azure.com/webhook/ae3921d3-262c-4503-99f0-939fb4709ab7', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });

                // Check for valid JSON response
                let data;
                try {
                    data = await res.json();
                } catch (e) {
                    const text = await res.text();
                    console.error('Response not JSON:', text);
                    appendMessage("⚠️ Received invalid response from server.");
                    chatBox.removeChild(typingBubble);
                    return;
                }

                chatBox.removeChild(typingBubble);

                if (data && data.message) {
                    const message = data.message.replace(/\n/g, '<br>');
                    appendMessage(message, 'bot');

                    // Extract any URL ending with .mp4 or Google Drive link
                    const urlRegex = /(https?:\/\/[^\s<>"]+\.(mp4))|(https?:\/\/drive\.google\.com\/file\/d\/[a-zA-Z0-9_-]+\/view)/gi;
                    const matches = [...data.message.matchAll(urlRegex)];
                    if (matches.length > 0) {
                        for (const match of matches) {
                            // match[0] is full matched URL
                            appendVideoOrEmbed(match[0].trim());
                        }
                    }
                } else {
                    appendMessage("⚠️ Sorry, I didn't get a proper response.");
                }

            } catch (err) {
                chatBox.removeChild(typingBubble);
                appendMessage("❌ Couldn't reach the AI service.");
            }
        }
    </script>
</body>
</html>